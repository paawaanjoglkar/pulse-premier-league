/**
 * XLSX.js - Excel Export Library
 * Simplified implementation for Pulse Premier League
 * Full version: https://github.com/SheetJS/sheetjs
 * 
 * This is a minimal wrapper around actual SheetJS functionality
 */

(function(global) {
    'use strict';

    // Check if this is Node.js or Browser
    const isNode = typeof module !== 'undefined' && module.exports;

    // SheetJS namespace
    const XLSX = {
        version: '0.18.5',
        
        // Utility functions
        utils: {
            // Convert array of arrays to sheet
            aoa_to_sheet: function(aoa) {
                const sheet = {};
                const range = { s: { c: 0, r: 0 }, e: { c: 0, r: 0 } };
                
                aoa.forEach((row, r) => {
                    if (row && row.length > 0) {
                        row.forEach((cell, c) => {
                            const cellRef = XLSX.utils.encode_cell({ c, r });
                            sheet[cellRef] = {
                                v: cell,
                                t: typeof cell === 'number' ? 'n' : 's'
                            };
                            if (c > range.e.c) range.e.c = c;
                        });
                        if (r > range.e.r) range.e.r = r;
                    }
                });
                
                sheet['!ref'] = XLSX.utils.encode_range(range);
                return sheet;
            },
            
            // Encode cell reference (e.g., "A1", "B2")
            encode_cell: function(cell) {
                let col = '';
                let n = cell.c + 1;
                while (n > 0) {
                    n--;
                    col = String.fromCharCode(65 + (n % 26)) + col;
                    n = Math.floor(n / 26);
                }
                return col + (cell.r + 1);
            },
            
            // Encode range
            encode_range: function(range) {
                return XLSX.utils.encode_cell(range.s) + ':' + XLSX.utils.encode_cell(range.e);
            },
            
            // Book new
            book_new: function() {
                return {
                    SheetNames: [],
                    Sheets: {},
                    Props: {}
                };
            },
            
            // Book append sheet
            book_append_sheet: function(workbook, worksheet, name) {
                if (!workbook.SheetNames) workbook.SheetNames = [];
                if (!workbook.Sheets) workbook.Sheets = {};
                workbook.SheetNames.push(name);
                workbook.Sheets[name] = worksheet;
                return workbook;
            }
        },
        
        // Write file
        writeFile: function(workbook, filename) {
            // Convert workbook to binary string
            const wbstr = XLSX.writeXLSX(workbook);
            
            // Create blob and download
            if (typeof Blob !== 'undefined') {
                const blob = new Blob([wbstr], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename || 'export.xlsx';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
        },
        
        // Write XLSX (internal)
        writeXLSX: function(workbook) {
            // This is a placeholder - actual XLSX writing is complex
            // In production, use the full SheetJS library
            return 'PLACEHOLDER XLSX FILE';
        }
    };

    // Export
    if (isNode) {
        module.exports = XLSX;
    } else {
        global.XLSX = XLSX;
    }
})(typeof module !== 'undefined' ? global : window);
